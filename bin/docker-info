#!/usr/bin/env perl
################################################################################
##                                                                            ##
##  dockerinfo - Display information about current docker components          ##
##                                                                            ##
##  Author:    Matt Martini                                                   ##
##                                                                            ##
##  Created:   2025-10-12   v0.1.0                                            ##
##                                                                            ##
##  Copyright Â© 2025  Matt Martini <matt.martini@imaginarywave.com>           ##
##                                                                            ##
################################################################################

########################################
#      Requirements and Packages       #
########################################

use App::Docker::Info::Syntax;
use App::Docker::Info qw(::Utils ::Image ::Container ::Volume ::System);

use Getopt::Long;
use Term::ANSIColor;

use Data::Dumper;
use Data::Printer class =>
    { expand => 'all', show_methods => 'none', parents => 0 };

Readonly my $PROGRAM => 'dockerinfo';
Readonly my $VERSION => version->declare("v0.2.0");

########################################
#      Define Global Variables         #
########################################

$Data::Dumper::Indent = 3;    # pretty print with array indices

local $OUTPUT_AUTOFLUSH = 1;

# Default config params
my %config = (
               image     => 0,    # Image
               container => 0,    # Container
               volume    => 0,    # Volume
               system    => 0,    # System
               debug     => 0,    # debugging
               verbose   => 0,    # Verbose output
               silent    => 0     # do not print report on stdout
             );

########################################
#            Main Program              #
########################################

process_args();

exit(0);

########################################
#           Subroutines                #
########################################
sub process_args {

    GetOptions(
                \%config,    "image",
                "container", "volume",
                "system",    "debug",
                "verbose+",  "silent",
                "help|?",    "version" => sub { say "version: $VERSION"; exit(0); },
              );

    # Sanity checks

    usage() if ( $Getopt::Long::error > 0 || $config{ help } );

    $config{ verbose }++ if ( $config{ debug } );

    usage("You must specify a type of Docker info to retreive.")
        unless ( $config{ image } | $config{ container } | $config{ volume }
                 | $config{ system } );

    return;

}

sub usage {
    my $msg = shift || '';
    print colored ( $msg, 'red' );
    print <<"END_USAGE";

Usage: $0 args <id>
         Arguments:
         --image      : Image info
         --container  : Container info
         --volume     : Volume info
         --system     : System info
         --debug      : Turn debugging on
         --verbose    : Generate debugging info on stderr
         --silent     : Do not print report on stdout
         --help       : This helpful information.

         id           : Specific Docker Object ID (optional)

         dockerinfo will list all of the docker objects of the specified type,
         or will display info on a specific object if an ID is given.

END_USAGE
    exit(1);
}

# vim: ft=perl
